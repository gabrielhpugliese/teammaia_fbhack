{% extends 'base.html' %}

{% block extra_body %}

<div id='player1'>
	<h2 class='turn'></h2>
	<h2 class='cards'></h2>
	<img src='' />
	<h3></h3>
	<a class="attr1"></a>
	<a class="attr2"></a>
	
</div>
<div id='player2'>
</div>
<a id='finish-button' href=''>Finish</a>
<script>
$(document).ready(function(){
	setTimeout('check_finish()', 1*1000);
	setTimeout('get_lock()', 1*1000);
	get_next_card();
});

$("#finish-button").click(function(event){
    event.preventDefault();
    console.log("clicado");
    $.post('/finish_game/',{ game_pk: {{ game_pk }} }, function(data) {
        console.log(data);
        self.location = '/canvas/';
    });
});

function check_finish(){
	setTimeout('check_finish()', 1*1000);
	$.get('/check_finish/{{ game_pk }}', function(data){
		if(data == 'OK'){
			self.location = '/canvas/';
		}
	})
}

function get_next_card(){
	var player = $('#player1');
	var data;
	$.get('/get_next_card/', {game_pk: {{ game_pk }}}, function(resp){
		data = $.parseJSON(resp);
		console.log(data);
		player.find('.cards').html('Cards Remaining:'+data.my_deck_len);
		player.find('img').attr('src', data.pic_square);
		player.find('h3').html(data.name);
	}).success(function(){
		$.get('/get_turn/{{ game_pk }}', function(resp){
			player.find('#turn').html('');
			if(resp == 'OK'){
				player.find('.turn').html('Your turn');
				player.find('.attr1').attr('href', '');
				player.find('.attr1').html('Friends: '+data.attr1);
				player.find('.attr2').attr('href', '');
				player.find('.attr2').html('Likes: '+data.attr2);
			} else {
				player.find('.turn').html('Your opponent\'s turn');
				player.find('.attr1').html('Friends: '+data.attr1);
				player.find('.attr2').html('Likes: '+data.attr2);
			}
		});
	});
}

function resolve_round(){
	$('a').click(function(event){
		event.preventDefault();
		console.log('NAO EH NOIZ');
		$.get('/resolve_round/', {attr: $(this).attr('id'), game_pk: {{ game_pk }} }, function(){
			console.log('EH NOIZ');
			get_next_card();
		});
	});
}

function get_lock(){
	setTimeout('get_lock()', 1*1000);
	$.get('/get_lock', { game_pk: {{ game_pk }} }, function(data){
		if(data == 'OK'){
			get_next_card();
		}
	})
}
</script>
{% endblock %}
